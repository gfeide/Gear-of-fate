# 自动化运维平台-Git-Git Lab-Jenkins

👋 Welcome to Notion!

# 第一节：DevOps概念介绍

DevOps是一种重视开发(Dev)和运维(Ops)之间沟通合作的文化、运动和实践。以下是DevOps的几个基本概念:

1. 自动化 - 将编译、测试、发布等流程自动化,使交付更轻松可靠。利用CI/CD等实践。
2. 持续集成 - 将代码集成到主分支上的频率更高,每天多次提交。快速发现和定位问题。
3. 持续交付/部署 - 将软件更频繁地、持续地交付给质量团队或用户,并能迅速部署到生产环境。
4. 基础设施即代码 - 将基础设施用代码方式实现,可以像应用程序代码一样进行版本管理等。
5. 监控和日志 - 扩展监控,从开发到运维全流程数据收集,并利用日志分析。
6. 敏捷思想 - 借鉴敏捷开发理念,提高团队的敏捷性。

综合来说,DevOps强调开发和运维之间的协作,通过自动化、监控等手段提高交付速度和质量。

## 1.DevOps起源

一款产品从零开始到最终交付大概包括如下几个阶段：规划、编码、构
建、测试、发布、部署、维护。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled.png)

最初，程序比较简单，工作量不大，程序员一个人可以完成所有阶段的工
作，但是随着软件产业的日益壮大，软件的功能也在不断的增加，随之而
来的就是复杂度不断的攀升，导致一个程序员无法在有效的时间完成所有
的工作，随后开始精细化分工。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%201.png)

分工之后，开发人员完成编码工作之后，将代码交给QA（质量保障）团队
进行测试，然后将最终的发布版交给运维团队去部署到生产环境对用户提
供服务，既开发、测试、部署。

但是早期的软件交付被人们称为瀑布模型。瀑布模型就是等一个阶段所有
工作完成之后，才能进入下一个阶段。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%202.png)

这种模型适合条件比较理想化（用户需求非常明确、开发时间非常充足）
的项目，大家按部就班的执行自己本质工作即可，但是随着用户的需求不
断增加，软件市场的竞争变得越加的激烈，根本无法实现理想化的交付，
在这个情况下，大家发现，笨重迟缓的瀑布式开发已经不合时宜，于是软
件开发团队引入了一个新的概念，那就是大名鼎鼎的——**敏捷开发**。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%203.png)

**敏捷开发可以大幅的提高开发团队的工作效率，让版本更新的速度变得更
块，更快的发现问题，产品更快的交付到用户手中，团队也可以快速得到
用户的反馈，从而进行快速的响应。**

## CI/CD概念 （持续集成/持续交付）

### CI（持续集成）

持续集成（Continuous Integration，简称CI）指的是频繁地（一天多次）
将代码集成到主干。
持续集成的目的就是让产品可以快速迭代，同时还能保证高质量，它的核
心措施是将代码集成到主干之前，必须通过自动化测试，只要有一个测试
用例失败，就不能集成。
通过持续集成，团队可以实现敏捷开发（速度快，效率高），简而言之，
敏捷开发很大一部分要归功于持续集成。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%204.png)

### CD（持续交付）

而CD则对应多个英文Continuous Delivery（持续交付）或者Continuous
Deployment（持续部署）。

持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环
境的「类生产环境」中再次进行测试。如果代码没有问题，可以继续手动
部署到生产环境中。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%205.png)

**持续部署则是在持续交付的基础上，把部署到生产环境的过程自动化。**

# 第二节：常见代码部署方式

## 1.蓝绿部署介绍

两个完全一样的生产环境配置部署的两套产品，一个是当前正在运行的生
产环境，它接收所有用户流量(蓝色)。另一个是它的克隆，但是是空闲的
(绿色)。两者使用的配置，数据库，主机等全部一致

**具体过程**

1. 当前版本业务正常访问 (蓝色) ；
2. 另一套环境部署新代码 (绿色) ，代码可能是增加功能或修复 BUG ；
3. 测试通过后将用户请求流量全部切到新版本 (绿色) 环境；
4. 观察测试，若新版本 (绿色) 稳定无异常，表示本次蓝绿发布成功；
5. 观察测试，若有异常直接切换旧版本（蓝色）；
6. 下次升级，将旧版本 (蓝色) 所在环境升级到新版本，继续进行蓝绿发
布，其特点是业务无中断，升级风险几乎为零；

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%206.png)

**适用场景：**

- 不停止 老版本，另部署一套新版本；测试完成之后，删除老版本；
- 蓝绿发布是一种用于升级与更新的发布策略，部署的最小维度是容器，而发布最小的维度是应用
- 蓝绿发布对于增量升级有比较好的支持，但是对于涉及数据表结构变更
等等不可逆转的升级，并不完全合适用蓝绿发布来实现，需要结合一些
业务的逻辑以及数据迁移与回滚的策略才可以完全满足需求。

## 金丝雀发布介绍

金丝雀发布也叫灰度发布，是指在灰与白之间，能够平滑过渡的一种发布
方式，灰度发布是**增量发布**的一种类型；灰度发布是在原有版本可用的情
况下，同时部署一些新版本应用作为 “金丝雀(小白鼠)” 进行测试新版本的
性能与表现等，以保障整个系统稳定持续正常运行的情况下，尽早发现、
调整问题。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%207.png)

**具体过程**

1. 准备好部署各个阶段的工件，包括：构建工件，测试脚本，配置文件和
部署清单文件；
2. 从负载均衡列表中移除掉 “金丝雀” 服务器；
3. 升级 “金丝雀” 应用（排掉原有流量并进行部署）；
4. 对应用进行自动化测试；
5. 将 “金丝雀” 服务器重新添加到负载均衡列表中（连通性和健康检
查）；
6. 如果 “金丝雀” 在线使用测试成功，升级剩余的其他服务器（否则就回
滚）。

**适用场景:**

- 不停止当前版本(V1)，另部署一套新版本(V2)，不同版本进行共存；
- 灰度发布中，经常设置权重进行分流；比如95%持续老版本(V1)，5%
尝试新版本(V2)；
- 经常与 A/B 测试一起使用，用于测试选择多种方案。

# 第三节：Git版本控制器

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%208.png)

## 1.概述

持续集成第一步就是开发人员将代码进行提交并推送到代码仓库，比如
**git、svn**。

## 2.版本控制器种类

版本控制器种类分为**分布式**版本控制器和**集中式**版本控制器。

![Untitled](%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0-Git-Git%20Lab-Jenkins%2046657a7a4e974cc1b9ae9a6039d8b09c/Untitled%209.png)

分布式版本控制器是不需要“中央服务器”的，每个人的电脑上都是一个
完整的版本库，这样在工作时就不需要联网了，因为版本库就在自己的
电脑上，在多人协作时，只需要把各自的修改推送给对方，就可以互相
看到对方的修改了。（**GIT**）

**SVN：集中式版本控制器**

CVS和SVN都是集中式的版本控制系统，集中式版本控制系统的版本库
是集中存放在中央服务器的，但是因为工作使用的是自己的电脑，所以
在工作之前需要从中央服务器获取最新的代码，并且在工作完成后需要
再上传到中央服务器

### 3.Git特别

Git优点：

- 适合分布式开发，强调个体；
- 公共服务器压力和数据量都不会太大；
- 速度快、灵活；
- 离线工作

GIt缺点：

- 代码保密性差，一旦开发者把整个库克隆下来就可以完全公开所有代码和版本信息；
- 权限控制不友好；如果需要对开发者限制各种权限的建议使用 SVN。

## 4.Git命令学习

| git config —global http://user.name “dingjia” | 配置Git用户 |
| --- | --- |
| git config - -global http://user.email “XX@email.com” | 配置GIT用户邮箱 |
| git config - -global color.ui true | 配置高亮颜色显示 |
| git config -l | 查看配置信息 |
| git init | 初始化工作目录 |
| tree .git/ | 以树状形式查看目录列表 |
| git add status | 查看工作区文件状态 |
| git add 文件名 | 提交文件到暂存区（所有的项目文件都需要经过暂存区才可以被提交到git仓库中） |
| git rm - -cache 文件名 | 将文件从暂存区删除 |
| git rm -f 文件名 | 同时删除暂存区文件与源文件 |
| git commit -m “提交说明” #说明自定义且支持中文 | 提交文件到本地仓库（每一次的commit代码提交相当于虚拟机的一次快照功能。随后可恢复到任意位置。） |
| git log | 查看仓库中历史提交信息 |
| git log - -oneline | 简要查看历史提交信息提示：如没有任何信息，表示没有差异。 |
| git mv a.txt b.txt | 如果需要修改文件名字，可直接使用git命令改名，这样git可以识别到变化： |
| git diff | 比对工作区与暂存区文件差异：提示：如没有任何信息，表示没有差异。 |
| git commit -am “提交信息” | 如果文件已经被仓库管理，再次更改此文件，可直接通过"-am"直接提交到
仓库中。 |
|  |  |